<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Resolved Complaints</title>
  <style>
    body {
      max-width:900px; margin:28px auto; padding:16px; 
      font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial
    }
    h1 {font-size:22px;margin-bottom:12px}
    table {width:100%;border-collapse:collapse;margin-top:16px;}
    th,td {padding:8px;border:1px solid #e6e6e6;text-align:left;}
    th {background:#f2f4f6;}
    button {padding:6px 10px;border:none;border-radius:4px;background:#28a745;color:white;cursor:pointer;}
    .backBtn {margin-top:16px;padding:8px 12px;border:none;background:#0366d6;color:white;border-radius:6px;cursor:pointer;}
    
    /* Modal style */
    .modal {
      display:none;
      position:fixed;
      z-index:1000;
      left:0; top:0;
      width:100%; height:100%;
      overflow:auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background:#fff;
      margin:10% auto;
      padding:20px;
      border-radius:6px;
      width:90%; max-width:500px;
    }
    .modal-content label {display:block;margin:6px 0;font-weight:600;}
    .modal-content input, .modal-content textarea {
      width:100%; padding:8px; margin-bottom:10px; border:1px solid #ccc; border-radius:4px; box-sizing:border-box;
    }
    .modal-content button {margin-right:8px;}
  </style>
</head>
<body>
  <h1>Resolved Complaint Details</h1>

  <table id="resolveTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Customer</th>
        <th>Department</th>
        <th>Location</th>
        <th>Complain</th>
        <th>Submitted At</th>
        <th>Preview</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button class="backBtn" onclick="window.location.href='index.html'">Back to List</button>

  <!-- Modal for editing -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <h3>Edit Complaint</h3>
      <label>Customer</label>
      <input type="text" id="editCustomer">
      <label>Department</label>
      <input type="text" id="editDepartment">
      <label>Location</label>
      <input type="text" id="editLocation">
      <label>Complain</label>
      <textarea id="editComplain" rows="3"></textarea>
      <label>Submitted At</label>
      <input type="text" id="editSubmittedAt" readonly>
      <div>
        <button id="saveBtn">Save</button>
        <button id="closeBtn">Close</button>
      </div>
    </div>
  </div>

  <script>
    // get existing resolved entries
    let resolvedEntries = JSON.parse(sessionStorage.getItem('resolved_entries') || '[]');

    // check if new single entry just came from index.html
    const newEntry = JSON.parse(sessionStorage.getItem('resolveEntry'));
    if(newEntry){
      resolvedEntries.push(newEntry);
      sessionStorage.setItem('resolved_entries', JSON.stringify(resolvedEntries));
      sessionStorage.removeItem('resolveEntry');
    }

    const tbody = document.querySelector('#resolveTable tbody');

    function renderTable(){
      tbody.innerHTML = '';
      if(resolvedEntries.length === 0){
        tbody.innerHTML = `<tr><td colspan="7">No data available</td></tr>`;
        return;
      }

      resolvedEntries.forEach((entry, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${entry.customer}</td>
          <td>${entry.department}</td>
          <td>${entry.location}</td>
          <td>${entry.complain}</td>
          <td>${entry.submittedAt}</td>
          <td><button class="previewBtn" data-index="${i}">Preview</button></td>
        `;
        tbody.appendChild(tr);
      });

      attachPreview();
    }

    function attachPreview(){
      document.querySelectorAll('.previewBtn').forEach(btn=>{
        btn.onclick = (ev)=>{
          const idx = Number(ev.target.dataset.index);
          openModal(idx);
        }
      });
    }

    const modal = document.getElementById('editModal');
    const editCustomer = document.getElementById('editCustomer');
    const editDepartment = document.getElementById('editDepartment');
    const editLocation = document.getElementById('editLocation');
    const editComplain = document.getElementById('editComplain');
    const editSubmittedAt = document.getElementById('editSubmittedAt');
    let currentIndex = null;

    function openModal(idx){
      currentIndex = idx;
      const entry = resolvedEntries[idx];
      editCustomer.value = entry.customer;
      editDepartment.value = entry.department;
      editLocation.value = entry.location;
      editComplain.value = entry.complain;
      editSubmittedAt.value = entry.submittedAt;
      modal.style.display = 'block';
    }

    document.getElementById('saveBtn').onclick = ()=>{
      if(currentIndex !== null){
        resolvedEntries[currentIndex] = {
          customer: editCustomer.value,
          department: editDepartment.value,
          location: editLocation.value,
          complain: editComplain.value,
          submittedAt: editSubmittedAt.value
        };
        sessionStorage.setItem('resolved_entries', JSON.stringify(resolvedEntries));
        renderTable();
        modal.style.display = 'none';
      }
    };

    document.getElementById('closeBtn').onclick = ()=>{
      modal.style.display = 'none';
    };

    // Click outside modal to close
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    renderTable();
  </script>
</body>
</html>
